<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .kanban-board {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .controls {
            margin: 20px;
        }
        
        .columns {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        
        .column {
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 5px;
            margin: 0 10px;
            flex: 1;
        }
        
        .ticket {
            background-color: white;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .ticket h3 {
            margin: 0 0 5px;
        }
        
        .ticket p {
            margin: 0;
        }
        
        /* Priority colors */
        .priority-4 {
            border-left: 5px solid red;
        }
        .priority-3 {
            border-left: 5px solid orange;
        }
        .priority-2 {
            border-left: 5px solid yellow;
        }
        .priority-1 {
            border-left: 5px solid green;
        }
        .priority-0 {
            border-left: 5px solid grey;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script>
        const { useState, useEffect } = React;

        const statuses = ["Todo", "In Progress", "Done"];
        const priorities = {
            4: "Urgent",
            3: "High",
            2: "Medium",
            1: "Low",
            0: "No priority",
        };

        const Ticket = ({ ticket }) => {
            return (
                <div className={`ticket priority-${ticket.priority}`}>
                    <h3>{ticket.title}</h3>
                    <p>{ticket.description}</p>
                    <p>Priority: {priorities[ticket.priority]}</p>
                    <p>Assigned to: {ticket.assignedUser}</p>
                </div>
            );
        };

        const SortingAndGrouping = ({ onGroupChange, onSortChange }) => {
            return (
                <div className="controls">
                    <select onChange={e => onGroupChange(e.target.value)}>
                        <option value="status">Group by Status</option>
                        <option value="user">Group by User</option>
                        <option value="priority">Group by Priority</option>
                    </select>
                    <select onChange={e => onSortChange(e.target.value)}>
                        <option value="priority">Sort by Priority</option>
                        <option value="title">Sort by Title</option>
                    </select>
                </div>
            );
        };

        const KanbanBoard = () => {
            const [tickets, setTickets] = useState([]);
            const [groupBy, setGroupBy] = useState("status");
            const [sortBy, setSortBy] = useState("priority");

            useEffect(() => {
                fetch("https://api.example.com/tickets")
                    .then(response => response.json())
                    .then(data => {
                        setTickets(data);
                        const savedState = JSON.parse(localStorage.getItem("kanbanState"));
                        if (savedState) {
                            setGroupBy(savedState.groupBy);
                            setSortBy(savedState.sortBy);
                        }
                    });
            }, []);

            const sortedTickets = tickets.sort((a, b) => {
                if (sortBy === "priority") {
                    return b.priority - a.priority;
                } else {
                    return a.title.localeCompare(b.title);
                }
            });

            const groupedTickets = sortedTickets.reduce((acc, ticket) => {
                const key = groupBy === "status" ? ticket.status : groupBy === "user" ? ticket.assignedUser : priorities[ticket.priority];
                if (!acc[key]) acc[key] = [];
                acc[key].push(ticket);
                return acc;
            }, {});

            useEffect(() => {
                localStorage.setItem("kanbanState", JSON.stringify({ groupBy, sortBy }));
            }, [groupBy, sortBy]);

            return (
                <div className="kanban-board">
                    <SortingAndGrouping onGroupChange={setGroupBy} onSortChange={setSortBy} />
                    <div className="columns">
                        {Object.keys(groupedTickets).map((key) => (
                            <div key={key} className="column">
                                <h2>{key}</h2>
                                {groupedTickets[key].map((ticket) => (
                                    <Ticket key={ticket.id} ticket={ticket} />
                                ))}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<KanbanBoard />, document.getElementById("root"));
    </script>
</body>
</html>
